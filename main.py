import base64
from fastapi import FastAPI, Depends, Request, HTTPException, status
from fastapi.responses import JSONResponse
from fastapi.middleware.cors import CORSMiddleware


app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/v1/map", response_class=JSONResponse)
def threat_map(request: Request):
    creds = request.headers.get("authorization")
    if not creds:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid username or password",
            headers={"WWW-Authenticate": "Basic"},
        )
    try:
        username, password = base64.b64decode(creds.replace("Basic", "").strip()).decode("utf-8").split(":")
    except ValueError as ve:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid username or password",
            headers={"WWW-Authenticate": "Basic"},
        )

    if username != "jose" and password != "0ed77b11f050123501f35863":
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid username or password",
            headers={"WWW-Authenticate": "Basic"},
        )





    return {
    "RU": 13168,
    "TF": 1,
    "DK": 211,
    "SV": 12,
    "SN": 52,
    "CZ": 536,
    "SI": 104,
    "KR": 12519,
    "JP": 8123,
    "BS": 10,
    "VE": 4894,
    "TL": 2,
    "UZ": 214,
    "AU": 2046,
    "CL": 534,
    "QA": 46,
    "BM": 3,
    "MZ": 76,
    "EE": 114,
    "AT": 379,
    "GE": 225,
    "TD": 3,
    "LI": 10,
    "CI": 45,
    "VN": 4409,
    "KW": 130,
    "AR": 3777,
    "NI": 32,
    "MG": 17,
    "BR": 11122,
    "RW": 15,
    "TJ": 33,
    "NA": 375,
    "PL": 1709,
    "LR": 24,
    "VU": 1,
    "BZ": 29,
    "YT": 2,
    "LA": 56,
    "MC": 27,
    "MT": 33,
    "BY": 200,
    "GI": 1,
    "EG": 1995,
    "LK": 79,
    "SA": 270,
    "DE": 8326,
    "TT": 56,
    "SK": 223,
    "SS": 4,
    "LT": 438,
    "JM": 28,
    "MU": 57,
    "SR": 10,
    "CY": 78,
    "PF": 65,
    "BB": 11,
    "SZ": 17,
    "AG": 2,
    "HU": 608,
    "FI": 686,
    "ST": 1,
    "RS": 219,
    "EC": 260,
    "TM": 31,
    "AO": 33,
    "KG": 97,
    "MR": 1,
    "TG": 10,
    "IE": 307,
    "JE": 4,
    "RE": 13,
    "DJ": 1,
    "BQ": 5,
    "BD": 1257,
    "SX": 5,
    "UA": 2647,
    "DO": 174,
    "ES": 1720,
    "NO": 293,
    "BA": 106,
    "TH": 2280,
    "TN": 204,
    "BH": 96,
    "PS": 132,
    "TR": 2264,
    "CU": 1,
    "MA": 322,
    "AL": 106,
    "SY": 29,
    "CO": 1204,
    "BE": 375,
    "DZ": 248,
    "PM": 2,
    "GF": 8,
    "AX": 3,
    "AZ": 233,
    "GL": 1,
    "GT": 88,
    "MM": 56,
    "PE": 318,
    "PY": 211,
    "CK": 1,
    "SG": 6687,
    "US": 43415,
    "KE": 515,
    "LY": 49,
    "YE": 39,
    "UG": 114,
    "NZ": 119,
    "KZ": 533,
    "SL": 6,
    "UY": 275,
    "HN": 136,
    "GU": 14,
    "AE": 334,
    "IQ": 473,
    "IR": 3762,
    "DM": 5,
    "NL": 4718,
    "IN": 20769,
    "CN": 45060,
    "GQ": 8,
    "NE": 8,
    "BN": 14,
    "ME": 27,
    "GM": 102,
    "LS": 10,
    "ZM": 58,
    "ET": 432,
    "CD": 29,
    "SD": 56,
    "TC": 1,
    "MY": 980,
    "XK": 48,
    "HK": 3841,
    "KM": 4,
    "MV": 8,
    "NP": 201,
    "MQ": 4,
    "VG": 16,
    "BW": 38,
    "MP": 1,
    "SE": 2097,
    "GH": 103,
    "KN": 10,
    "BF": 25,
    "CH": 563,
    "BT": 10,
    "SC": 173,
    "AW": 14,
    "VI": 9,
    "PW": 12,
    "PK": 1555,
    "TW": 7448,
    "BO": 242,
    "LU": 289,
    "CA": 2621,
    "ML": 4,
    "Not Found": 75,
    "PR": 53,
    "FR": 3909,
    "KY": 6,
    "FJ": 5,
    "LV": 220,
    "PG": 5,
    "MX": 2287,
    "GG": 2,
    "RO": 599,
    "CW": 27,
    "TZ": 93,
    "BI": 20,
    "SO": 20,
    "MO": 83,
    "PH": 543,
    "ZW": 222,
    "ER": 1,
    "NC": 2,
    "LC": 3,
    "CG": 38,
    "FO": 2,
    "GA": 5,
    "IM": 5,
    "ID": 4738,
    "GY": 3,
    "OM": 16,
    "MN": 153,
    "WS": 1,
    "AM": 181,
    "KI": 1,
    "AF": 84,
    "PA": 165,
    "LB": 111,
    "HT": 7,
    "MD": 259,
    "AD": 11,
    "ZA": 897,
    "GN": 15,
    "PT": 600,
    "TO": 3,
    "NG": 379,
    "IL": 583,
    "JO": 93,
    "BG": 965,
    "IT": 2886,
    "GB": 5190,
    "IS": 79,
    "GP": 21,
    "CR": 131,
    "HR": 163,
    "MK": 138,
    "KH": 437,
    "GR": 429,
    "GD": 2,
    "MW": 53,
    "BJ": 28,
    "CM": 68,
    "CV": 332
}
